--- a/src/afs/afs.h	2016-04-27 10:30:51.000000000 -0400
+++ b/src/afs/afs.h	2016-06-05 03:33:04.915878712 -0400
@@ -713,7 +713,7 @@
 #define VTOAFS(v) ((struct vcache *)(v)->v_data)
 #define AFSTOV(vc) ((vc)->v)
 #else
-#define VTOAFS(V) ((struct vcache *)(V))
+#define VTOAFS(V) ((struct vcache *)(V->v_data))
 #define AFSTOV(V) (&(V)->v)
 #endif

--- a/src/afs/LINUX/osi_vfs.h	2016-04-27 10:30:51.000000000 -0400
+++ b/src/afs/LINUX/osi_vfs.h	2016-06-04 05:00:36.933537760 -0400
@@ -24,7 +24,7 @@
 #define v_fop           i_fop
 #define v_type		i_mode
 #define v_vfsp		i_sb
-#define v_data		u.generic_ip
+#define v_data		i_private
 
 /* v_type bits map to mode bits */
 #define VNON 0
